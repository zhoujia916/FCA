
<title>Puzzle Admin</title>
<style type="text/css">

</style>
<div class="page-header">
    <h4>
        <i class="glyphicon glyphicon-signal"></i>
        员工管理
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            {{if $action eq 'CREATE'}}
                新建员工
            {{elseif $action eq 'UPDATE'}}
                编辑员工
            {{elseif $action eq 'VIEW'}}
                查看员工详情
            {{/if}}

        </small>

        <a class="btn btn-xs orange pull-right btn-warning" href="#page/fcauser/index">
            <i class="glyphicon glyphicon-arrow-left"></i>返回员工管理</span></a>
    </h4>
</div>

<div class="row" id="">
    <div class="col-xs-12">
        <form class="form-horizontal" id="form">
            <div class="space-10"></div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    用户名
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <input type="text" id="userName" name="userName" placeholder="用户名" class="txt input-sm col-sm-6">
                {{elseif $action eq 'UPDATE'}}
                <input hidden="hidden" name="userId" id="userId" value="{{$user.userId}}"/>
                <input type="text" id="userName" name="userName" placeholder="用户名" value="{{$user.userName}}" class="txt input-sm col-sm-6">
                {{elseif $action eq 'VIEW'}}
                {{$user.userName}}
                {{/if}}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    生日
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <input type="text" id="birth" name="birthString" placeholder="生日" class="txt input-sm col-sm-4">
                {{elseif $action eq 'UPDATE'}}
                <input type="text" id="birth" name="birthString" placeholder="生日" value="{{if $user.birthString}}{{$user.birthString}}{{/if}}" class="txt input-sm col-sm-4">
                {{elseif $action eq 'VIEW'}}
                {{if $user.birthString}}{{$user.birthString}}{{/if}}
                {{/if}}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    手机号码
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <input type="text" id="phone" name="phone" placeholder="手机号码" class="txt input-sm col-sm-4">
                {{elseif $action eq 'UPDATE'}}
                <input type="text" id="phone" name="phone" placeholder="手机号码" value="{{if $user.phone}}{{$user.phone}}{{/if}}" class="txt input-sm col-sm-4">
                {{elseif $action eq 'VIEW'}}
                {{if $user.phone}}{{$user.phone}}{{/if}}
                {{/if}}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    邮箱地址
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <input type="text" id="email" name="email" placeholder="邮箱地址" class="txt input-sm col-sm-4">
                {{elseif $action eq 'UPDATE'}}
                <input type="text" id="email" name="email" placeholder="邮箱地址" value="{{if $user.email}}{{$user.email}}{{/if}}" class="txt input-sm col-sm-4">
                {{elseif $action eq 'VIEW'}}
                {{if $user.email}}{{$user.email}}{{/if}}
                {{/if}}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    用户图像
                </label>
                <div class="col-sm-4" style="height:62px;"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE' or $action eq 'UPDATE'}}
                <input type="hidden" id="hidUserAvatar" name="userAvatar" />
                <input type="file" id="userAvatar" name="file" placeholder="封面图片">
                {{elseif $action eq 'VIEW'}}
                <img src="{{$user.userAvatar}}" style="height:100%;" />
                {{/if}}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    部门
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <input type="text" id="dept" name="dept" placeholder="部门" class="txt input-sm col-sm-4">
                {{elseif $action eq 'UPDATE'}}
                <input type="text" id="dept" name="dept" placeholder="部门" value="{{if $user.dept}}{{$user.dept}}{{/if}}" class="txt input-sm col-sm-4">
                {{elseif $action eq 'VIEW'}}
                {{if $user.dept}}{{$user.dept}}{{/if}}
                {{/if}}
            </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    状态
                </label>
                <div class="col-sm-9"{{if $action eq 'VIEW'}} style="padding-top:10px;"{{/if}}>
                {{if $action eq 'CREATE'}}
                <div class="position-relative">
                <input type="radio" value="1" name="status" class="ace">
                <label class="lbl">无效</label>
                &nbsp;&nbsp;
                <input type="radio" value="2" name="status" class="ace" checked>
                <label class="lbl">有效</label>
                </div>
                {{elseif $action eq 'UPDATE'}}
                <div class="position-relative">
                <input type="radio" value="1" name="status" class="ace" {{if $user.status == 1}} checked {{/if}}>
                <label class="lbl">无效</label>
                &nbsp;&nbsp;
                <input type="radio" value="2" name="status" class="ace" {{if $user.status == 2}} checked {{/if}}>
                <label class="lbl">有效</label>
                </div>
                {{elseif $action eq 'VIEW'}}
                {{if $user.status eq 1}}账户有效{{/if}}
                {{if $user.status eq 2}}账户无效{{/if}}
                {{/if}}
                </div>
            </div>
            <br><br>
            {{if $action eq 'CREATE' or $action eq 'UPDATE'}}
            <div class="clearfix form-actions">
                <button id="btnReset" class="btn" type="reset">
                    <i class="ace-icon fa fa-undo bigger-110"></i>
                    重置
                </button>
                &nbsp; &nbsp;
                <button id="btnSubmit" data-action="{{$action}}" class="btn btn-info" type="button">
                    <i class="ace-icon fa fa-check bigger-110"></i>
                    确定
                </button>
            </div>
            {{/if}}
        </form>


    </div><!-- /.col -->
</div><!-- /.row -->
<script type="text/javascript">
    $('.page-content-area').ace_ajax('loadScripts', [null, null], function() {
        $( "#birth" ).datepicker({
            showOtherMonths: true,
            selectOtherMonths: false
        });

        {{if $action eq 'CREATE' or $action eq 'UPDATE'}}
        var spliter = "";
        $("#btnSubmit").on("click",function(){
            var name = $.trim($("#userName").val());
            var phone = $.trim($("#phone").val());
            var birth = $.trim($("#birth").val());
            var email = $.trim($("#email").val());
            var pat = new RegExp("^[A-Za-z0-9]+$");
            var phoneReg = /^\d{11}$/;
            var emailReg = /^[\w\W]+@[\w\W]+$/;
            if(name == ""){
                showTip("用户名不能为空");
                $("#userName").focus();
                return;
            }
            if(name.length<3 || name.length>20){
                showTip("用户名长度必须在3-20范围内");
                $("#userName").focus();
                return;
            }
            if(!pat.test(name)){
                showTip("用户名只能是数字和字母的组合");
                $("#userName").focus();
                return;
            }
            if(phone != ""){
                if(!phoneReg.test(phone)){
                    showTip("请输入正确的电话号码");
                    $("#phone").focus();
                    return;
                }
            }
            if(email == ""){
                showTip("邮箱不能为空");
                $("#email").focus();
                return;
            }
            if(email != ""){
                if(!emailReg.test(email)){
                    showTip("请输入正确的邮箱");
                    $("#email").focus();
                    return;
                }
            }
            $.post("{{$contextPath}}/admin/fcauser/action.do","action=" + $(this).attr("data-action") + "&"+$("form").serialize(),function(result){
                if(result.code==0){
                    changeHash("page/fcauser/index");
                }else{
                    showAlert(result.msg);
                }
            });
        });

        $("#birthString").datepicker({
            showOtherMonths: true,
            selectOtherMonths: false
        });

        var userAvatar = $('#userAvatar').ace_file_input({
            style:'well',
            allowExt: ["jpeg", "jpg", "png", "gif" , "bmp"],
            allowMime: ["image/jpg", "image/jpeg", "image/png", "image/gif", "image/bmp"],

            btn_choose:'拖放或点击选择图片',
            btn_change:null,
            no_icon:'ace-icon fa fa-cloud-upload',
            droppable:true,
            thumbnail:'small',
            //,icon_remove:null//set null, to hide remove/reset button
            /**,before_change:function(files, dropped) {
						//Check an example below
						//or examples/file-upload.html
						return true;
					}*/
            before_remove : function() {
                $("#hidUserAvatar").val("");
                return true;
            },
            preview_error : function(filename, error_code) {
                var errorMsg = '';
                if(error_code == 2){
                    errorMsg = "加载读取图片出错";
                }else if(error_code == 3){
                    errorMsg = "创建缩列图出错";
                }
                showTip(errorMsg);
                //name of the file that failed
                //error_code values
                //1 = 'FILE_LOAD_FAILED',
                //2 = 'IMAGE_LOAD_FAILED',
                //3 = 'THUMBNAIL_FAILED'
                //alert(error_code);
            }
        });
        {{/if}}
        {{if $action eq 'UPDATE'}}
        var files = [{
            name: "temp.jpeg",
            type: "image",
            path: "{{$user.userAvatar}}"
        }];
        userAvatar.ace_file_input("show_file_list", files, false);
        {{/if}}
    });
</script>
